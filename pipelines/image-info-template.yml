parameters:
- name: name
  displayName: Name
  type: string
  default: toolsContainer
- name: dependsOn
  type: object
  default: null
- name: displayName
  displayName: Display Name
  type: string
  default: Tools Container Info
- name: imageTag
  displayName: Image tag
  type: string
  default: latest

jobs:
- job: ${{ parameters.name }}
  dependsOn: ${{ parameters.dependsOn }}
  displayName: ${{ parameters.displayName }}
  variables:
  - group: 'build-container-agent-image' # shared with deploy-container-agents.yml
  # should contain 'containerRegistry', 'containerRegistryConnection' -> name of Container Registry Service Connection
  - name: 'toolsImageFQName'
    value: $(containerRegistry).azurecr.io/pipelineagent/ubuntu:${{ parameters.imageTag }}
  - name: 'vmImage'
    value: ubuntu-latest
  pool:
    vmImage: 'ubuntu-latest'
  container:
    image: $(toolsImageFQName)
    endpoint: containerEndpoint
  steps:
  - bash: |
      echo Hello from Ubuntu
      lsb_release -d
    displayName: 'Ubuntu info'
  - pwsh: |
      az -v
    displayName: 'Azure CLI info'
  - pwsh: |
      Write-Host "`$PSVersionTable.OS"
      $PSVersionTable.OS
      Get-InstalledModule | Sort-Object -Property Name
    displayName: 'PowerShell info'
  - pwsh: |
      terraform -v
    displayName: 'Terraform info'
